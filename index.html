<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Castify - Home</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-storage.js"></script>
  <!-- reCAPTCHA v2 API -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    /* –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è reCAPTCHA */
    #main-content {
      display: none;
    }
    #recaptcha-container {
      text-align: center;
      margin-top: 20%;
    }
  </style>
</head>
<body>
  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è reCAPTCHA -->
  <div id="recaptcha-container">
    <h2>Please verify that you're not a robot</h2>
    <div class="g-recaptcha" data-sitekey="6LdV16kqAAAAAI4x1RVMy9oBCbJkGG42Q1Wteoll"></div>
    <button onclick="verifyRecaptcha()">Verify</button>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–∫—Ä—ã—Ç –¥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è reCAPTCHA) -->
  <div id="main-content">
    <header>
      <nav class="navbar">
        <div class="logo">
          <img src="https://i.ibb.co/nCqS9g0/rushfordclean-1.png" id="logo-img" alt="Castify Logo" onclick="reloadPage()">
        </div>
        <ul class="nav-links">
          <li><a href="#videos">Videos</a></li>
          <li><a href="#channels">Channels</a></li>
          <li><a href="#newest">Newest</a></li>
          <li><a href="#community">Community</a></li>
        </ul>
        <div class="search-bar">
          <input type="text" placeholder="Search...">
          <button>üîç</button>
        </div>
        <div class="user-actions">
          <img src="https://cdn.pixabay.com/photo/2020/10/31/06/28/youtube-bell-icon-5700370_1280.png" id="notification-icon" alt="Notifications" class="icon" onclick="toggleNotifications()" style="display:none;">
          <span id="notification-count" class="hidden">0</span>
          <div id="notification-popup" class="hidden">
            <ul id="notifications-list">
              <li>No notifications</li>
            </ul>
          </div>
          <div id="user-profile" class="hidden">
            <span id="username-display"></span> | <a href="profile.html">Profile</a>
          </div>
          <button id="login-button" onclick="toggleLoginState()">Login / Register</button>
          <button id="upload-button" class="hidden" onclick="uploadVideo()">Upload Video</button>
        </div>
      </nav>
    </header>

    <main>
      <div id="left-ad" class="ad-banner left-ad hidden"></div>
      <section id="welcome-section">
        <h1>Welcome to Castify</h1>
        <p>Your hub for discovering and sharing amazing videos.</p>
      </section>
      <section id="content">
        <h2>Recommended for You</h2>
        <div id="recommendations" class="recommendations-list"></div>
      </section>
      <div id="right-ad" class="ad-banner right-ad hidden"></div>
    </main>

    <footer>
      <p>¬© 2024 Castify. All rights reserved.</p>
    </footer>
  </div>

  <script src="app.js"></script>
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCT0puD2gqEj4EYoeC5HtXYI95InuX4z9Q",
      authDomain: "castify-5c0b6.firebaseapp.com",
      projectId: "castify-5c0b6",
      storageBucket: "castify-5c0b6.appspot.com",
      messagingSenderId: "897995118693",
      appId: "1:897995118693:web:708006eb85fdd77ab5ce8c"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ reCAPTCHA
    function verifyRecaptcha() {
      const recaptchaResponse = grecaptcha.getResponse();
      if (recaptchaResponse.length === 0) {
        alert("Please complete the CAPTCHA.");
        return;
      }
      handleLoginWithRecaptcha(recaptchaResponse); // –ï—Å–ª–∏ CAPTCHA –ø—Ä–æ–π–¥–µ–Ω–∞, –ø—Ä–æ–¥–æ–ª–∂–∏–º
    }

    // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Å–º–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Ö–æ–¥–∞
    function toggleLoginState() {
      if (auth.currentUser) {
        auth.signOut();
        document.getElementById("login-button").textContent = "Login / Register";
        document.getElementById("notification-icon").style.display = "none";
        document.getElementById("upload-button").classList.add("hidden");
      } else {
        getRecaptchaToken();  // –ü–æ–ª—É—á–∞–µ–º reCAPTCHA –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
      }
    }

    // –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º reCAPTCHA —Ç–æ–∫–µ–Ω–∞
    function handleLoginWithRecaptcha(token) {
      const credential = firebase.auth.GoogleAuthProvider.credential(null, token);
      auth.signInWithCredential(credential).then((userCredential) => {
        console.log("User logged in:", userCredential.user);
        document.getElementById("login-button").textContent = "Logout";
        document.getElementById("notification-icon").style.display = "block";
        document.getElementById("upload-button").classList.remove("hidden");
        
        // –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è CAPTCHA –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
        document.getElementById("recaptcha-container").style.display = "none";
        document.getElementById("main-content").style.display = "block";
      }).catch((error) => {
        console.error("Error logging in:", error);
      });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤–∏–¥–µ–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    function checkForVideos() {
      db.collection("videos").get().then(snapshot => {
        if (snapshot.empty) {
          document.getElementById("upload-button").classList.add("hidden");
        } else {
          document.getElementById("upload-button").classList.remove("hidden");
        }
      });
    }

    // –ö–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
    window.onload = () => {
      checkForVideos();
    };
  </script>
</body>
</html>
